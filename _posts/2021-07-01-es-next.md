---
title: ES next
description: ES next
date: '2021-07-01'
author: Yoha
location: Beijing
image: https://gitee.com/yancqS/blogImage/raw/master/blogImage/20210704162016.jpeg
tags:
    - JavaScript
meta:
  - name: title
    content: ES next
  - name: description
    content: ES next
  - name: keywords
    content: ES, next
  - name: author
    content: Yoha
featured: true
---
# ES next

1. replaceAll

```js
let str = 'abc abf adabfasdadfa';
console.log(str.replace('a', '*'));// *bc abf adabfasdadfa
console.log(str.replace(/a/, '*'));// *bc abf adabfasdadfa
console.log(str.replace(/a/g, '*'));// *bc *bf *d*bf*sd*df*

console.log(str.replaceAll('a', '*'));// *bc *bf *d*bf*sd*df*
// console.log(str.replaceAll(/a/, '*')); 报错，replaceAll 当使用一个 `regex`时，您必须设置全局（“ g”）标志
console.log(str.replaceAll(/a/g, '*'));// *bc *bf *d*bf*sd*df*
```

> 当使用一个 `regex`时，您必须设置全局（“ g”）标志，否则，它将引发 `TypeError`：“必须使用全局 RegExp 调用 replaceAll”。

2. 数字分隔符

```js
let a = 10_000_000_0000_0;
console.log(a);// 1000000000000
```

> 主要是便于阅读，书写比较长的数字。

3. 逻辑赋值运算符

之前主要存在的复合赋值运算符：+=、-=、*=、/=、%=、<<=、>>=、>>>=

新版本中增加了逻辑赋值运算符：&&=、||=

```js
function request(options = {}) {
   options.method ||= 'get';// 等价于 options.method = options.method || 'get';
   console.log(options.method);
 }
 request(); // 'get'
 request({
   method: 'post'
 }); // 'post'
```

4. Promise.allSettled()

该`Promise.allSettled()`方法返回一个在所有给定的promise都已经`fulfilled`**或**`rejected`后的promise，并带有一个对象数组，每个对象表示对应的promise结果。

当您有多个彼此不依赖的异步任务成功完成时，或者您总是想知道每个`promise`的结果时，通常使用它。

相比之下，`Promise.all()` 更适合彼此相互依赖或者在其中任何一个`reject`时立即结束。

```js
const promise1 = Promise.resolve(3);
const promise2 = new Promise((resolve, reject) => setTimeout(reject, 100, 'foo'));
const promises = [promise1, promise2];
(async () => {
  const data = await Promise.allSettled(promises);
  data.forEach((item) => {
    console.log(item);
  })
})();

//output:
// "fulfilled"
// "rejected"
```

5. Promise.any()

`Promise.any()` 接收一个[`Promise`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise)可迭代对象，只要其中的一个 `promise` 成功，就返回那个已经成功的 `promise` 。如果可迭代对象中没有一个 `promise` 成功（即所有的 `promises` 都失败/拒绝），就返回一个失败的 `promise `和[`AggregateError`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/AggregateError)类型的实例，它是 [`Error`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error) 的一个子类，用于把单一的错误集合在一起。本质上，这个方法和[`Promise.all()`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)是相反的。

```js
(async () => {
    const data = await Promise.any([
      new Promise((resolve, reject) => {
        setTimeout(() => {
          reject('2 second');
        }, 2000)
      }),
      new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve('5 second');
        }, 5000)
      })
    ]);
    console.log(data);
 })();

// output:
// 5 second
```

与Promise.race()的区别：

- Promise.any(): 以第一个**成功** (resolve) 为准，失败不管
- Promie.race(): 以第一个**完成** (迭代器中的某个promise成功『resolve』或失败『reject』) 的为准

```js
(async () => {
    const data = await Promise.race([
      new Promise((resolve, reject) => {
        setTimeout(() => {
          reject('2 second');
        }, 2000)
      }),
      new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve('5 second');
        }, 5000)
      })
    ]);
    console.log(data);
})();

// output:
// Uncaught (in promise) 2 second
```

6. [weakRefs](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakRef)

之前存在弱引用：[weakMap](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)、[weakSet](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakSet)

